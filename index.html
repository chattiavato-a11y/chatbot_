<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Chattia for OPS</title>
  <meta name="description" content="Chattia for OPS — secure, fast, accessible assistant UI." />
  <meta name="referrer" content="no-referrer" />

  <!-- Fallback CSP (best-effort on static hosts).
       For A+ scores, set these as REAL HTTP response headers at the edge. -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    base-uri 'none';
    object-src 'none';
    frame-ancestors 'none';
    form-action 'self';
    img-src 'self' data:;
    font-src 'self' data:;
    style-src 'self';
    script-src 'self' https://challenges.cloudflare.com;
    connect-src 'self' https://ops-gateway.grabem-holdem-nuts-right.workers.dev;
    frame-src https://challenges.cloudflare.com;
    worker-src 'self';
    manifest-src 'self';
    media-src 'self';
    upgrade-insecure-requests;
    report-uri https://ops-gateway.grabem-holdem-nuts-right.workers.dev/reports/csp;
  ">

  <link rel="stylesheet" href="assets/chattia-ui.css" />

  <!-- Cloudflare Turnstile -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" defer crossorigin="anonymous"></script>

  <!-- App -->
  <script src="assets/chattia-ui.js" defer></script>
</head>
<body>
  <noscript>
    <div class="noscript">
      This app requires JavaScript to run.
    </div>
  </noscript>

  <div class="bg" aria-hidden="true"></div>

  <div class="shell">
    <header class="topbar" role="banner">
      <div class="brand">
        <div class="brand-mark" aria-hidden="true"></div>
        <div class="brand-text">
          <div class="brand-title" data-en="Chattia for OPS" data-es="Chattia para OPS">Chattia for OPS</div>
          <div class="brand-sub" data-en="Secure assistant UI" data-es="UI segura del asistente">Secure assistant UI</div>
        </div>
      </div>

      <nav class="top-actions" aria-label="Policy links and settings">
        <a class="pill-link" href="https://www.chattia.io/privacy" target="_blank" rel="noopener noreferrer">
          <span data-en="Privacy" data-es="Privacidad">Privacy</span>
        </a>
        <a class="pill-link" href="https://www.chattia.io/terms" target="_blank" rel="noopener noreferrer">
          <span data-en="Terms" data-es="Términos">Terms</span>
        </a>

        <div class="divider" aria-hidden="true"></div>

        <button type="button" id="langCtrl" class="pill-btn" aria-pressed="false"
          aria-label="Toggle language" data-en-label="Toggle language" data-es-label="Cambiar idioma">EN</button>

        <button type="button" id="themeCtrl" class="pill-btn" aria-pressed="false"
          aria-label="Toggle theme" data-en-label="Toggle theme" data-es-label="Cambiar tema">Dark</button>

        <button type="button" id="speechToggle" class="pill-btn" aria-pressed="false"
          aria-label="Toggle voice output" data-en-label="Toggle voice output" data-es-label="Activar voz">
          <span data-en="Voice" data-es="Voz">Voice</span>
        </button>
      </nav>
    </header>

    <main class="panel" role="main">
      <section class="chat" aria-label="Chat">
        <div class="chat-head">
          <div class="status">
            <span class="dot" id="netDot" aria-hidden="true"></span>
            <span id="netText" data-en="Ready" data-es="Listo">Ready</span>
          </div>

          <div class="mini-actions">
            <button type="button" id="clearChat" class="ghost-btn"
              aria-label="Clear chat" data-en-label="Clear chat" data-es-label="Borrar chat">
              <span data-en="Clear" data-es="Borrar">Clear</span>
            </button>

            <button type="button" id="openTranscript" class="ghost-btn"
              aria-label="Open transcript" data-en-label="Open transcript" data-es-label="Abrir transcripción">
              <span data-en="Transcript" data-es="Transcripción">Transcript</span>
            </button>
          </div>
        </div>

        <div id="chat-log" class="chat-log" aria-live="polite" aria-relevant="additions text"></div>

        <div class="composer">
          <div class="consent-inline" id="inline-consent" role="region" aria-live="polite">
            <div class="consent-text"
              data-en="Preferences (language/theme) are stored only if you accept. Messages are sent to the OPS gateway."
              data-es="Las preferencias (idioma/tema) se guardan solo si aceptas. Los mensajes se envían al gateway de OPS.">
              Preferences (language/theme) are stored only if you accept. Messages are sent to the OPS gateway.
            </div>
            <div class="consent-actions">
              <button type="button" id="inline-consent-accept" class="link-btn"
                data-en="Accept" data-es="Aceptar">Accept</button>
              <button type="button" id="inline-consent-deny" class="link-btn"
                data-en="Deny" data-es="Rechazar">Deny</button>
            </div>
          </div>

          <div class="ctrl-row" aria-label="Input controls">
            <button type="button" id="listenCtrl" class="mic-btn" aria-pressed="false"
              aria-label="Start voice input" data-en-label="Start voice input" data-es-label="Comenzar voz">
              <svg viewBox="0 0 24 24" class="ic" aria-hidden="true">
                <path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 1 0-6 0v5a3 3 0 0 0 3 3zm5-3a5 5 0 0 1-10 0H5a7 7 0 0 0 14 0h-2zM11 19h2v3h-2z"/>
              </svg>
              <span class="mic-label" data-en="Speak" data-es="Hablar">Speak</span>
            </button>

            <div id="voice-status" class="voice-status" role="status" aria-live="polite"></div>

            <div class="turnstile-wrap" id="turnstile-container" aria-label="Cloudflare Turnstile verification">
              <div id="turnstile-widget" class="cf-turnstile"
                data-sitekey="0x4AAAAAACCemZgiIexxcpTR"
                data-callback="opsTurnstileCallback"
                data-expired-callback="opsTurnstileExpired"
                data-error-callback="opsTurnstileErrored"></div>
            </div>
          </div>

          <form id="chatbot-input-row" class="input-row" autocomplete="off">
            <label class="sr-only" for="chatbot-input">Message</label>
            <input id="chatbot-input" class="input" type="text" maxlength="256" required
              placeholder="Type your message..."
              data-en-ph="Type your message..." data-es-ph="Escriba su mensaje..." />

            <!-- Honeypots (bots fill these) -->
            <div class="hp-wrap" aria-hidden="true">
              <label>email<input id="hp_email" name="hp_email" type="text" autocomplete="off"></label>
              <label>website<input id="hp_website" name="hp_website" type="text" autocomplete="off"></label>
            </div>

            <button id="chatbot-send" class="send-btn" type="submit" aria-label="Send">
              <svg viewBox="0 0 24 24" class="ic" aria-hidden="true">
                <path d="M2 21l20-9L2 3v7l14 2L2 14v7z"/>
              </svg>
            </button>
          </form>

          <div class="footnote">
            <button type="button" id="tnc-button" class="tnc"
              data-en="T&C" data-es="TyC"
              data-en-msg="Interacting with the chatbot sends requests to the OPS gateway."
              data-es-msg="Interactuar con el chatbot envía solicitudes al gateway de OPS.">T&C</button>
          </div>
        </div>
      </section>

      <aside class="drawer" id="transcriptDrawer" aria-label="Transcript panel" aria-hidden="true">
        <div class="drawer-head">
          <div class="drawer-title" data-en="Transcript" data-es="Transcripción">Transcript</div>
          <button type="button" id="closeTranscript" class="ghost-btn"
            aria-label="Close transcript" data-en-label="Close transcript" data-es-label="Cerrar transcripción">
            <span data-en="Close" data-es="Cerrar">Close</span>
          </button>
        </div>

        <pre id="transcript-text" class="transcript" role="region" aria-live="polite"></pre>

        <div class="drawer-actions">
          <button type="button" id="transcript-copy" class="pill-btn"
            aria-label="Copy transcript" data-en-label="Copy transcript" data-es-label="Copiar transcripción">
            <span data-en="Copy" data-es="Copiar">Copy</span>
          </button>
        </div>
      </aside>
    </main>

    <footer class="footer" role="contentinfo">
      <span class="muted" data-en="OPS Online Support • Secure by design" data-es="OPS Online Support • Seguro por diseño">
        OPS Online Support • Secure by design
      </span>
    </footer>
  </div>

  <!-- Consent toast -->
  <div id="consent-banner" class="toast" role="region" aria-live="polite" aria-hidden="true">
    <div class="toast-title" data-en="Privacy & consent" data-es="Privacidad y consentimiento">Privacy & consent</div>
    <div class="toast-body"
      data-en="We store language/theme only if you accept. Chat requests are sent to the OPS gateway."
      data-es="Guardamos idioma/tema solo si aceptas. Las solicitudes se envían al gateway de OPS.">
      We store language/theme only if you accept. Chat requests are sent to the OPS gateway.
    </div>
    <div class="toast-actions">
      <button type="button" id="consent-accept" class="pill-btn" data-en="Accept" data-es="Aceptar">Accept</button>
      <button type="button" id="consent-deny" class="pill-btn" data-en="Deny" data-es="Rechazar">Deny</button>
    </div>
  </div>
</body>
</html>
