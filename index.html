<!-- index.html
     OPS Online Support — Chat Only

     Notes:
     - No inline JS. Uses /assets/*.js
     - Chat uses gateway endpoint (set in assets/chattia-ui.js config)
     - Privacy/Consent modal required before enabling chat
     - “Compliance-aligned” UX: no sensitive data, no card data, no passwords/OTPs
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chattia • Chat</title>

  <!-- Basic hardening (best delivered via headers, but meta helps on static hosting) -->
  <meta name="referrer" content="no-referrer" />
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="X-Frame-Options" content="DENY" />

  <!-- CSP: keep strict; update connect-src to your gateway -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'none';
    base-uri 'none';
    object-src 'none';
    frame-ancestors 'none';
    form-action 'self';
    img-src 'self' data:;
    font-src 'self' data:;
    style-src 'self';
    script-src 'self' https://challenges.cloudflare.com;
    connect-src 'self' https://ops-gateway.grabem-holdem-nuts-right.workers.dev https://challenges.cloudflare.com;
    frame-src https://challenges.cloudflare.com;
    upgrade-insecure-requests;
  " />

  <!-- OPS Gateway config for assets/chattia-ui.js -->
  <meta name="ops-gateway" content="https://ops-gateway.grabem-holdem-nuts-right.workers.dev" />
  <meta name="ops-asset-id" content="ops-online-support-site" />
  <meta name="ops-turnstile-sitekey" content="" />

  <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml" />

  <!-- Theme + UI -->
  <link rel="stylesheet" href="/assets/chattia-theme.css" />
  <link rel="stylesheet" href="/assets/chattia-ui.css" />

  <!-- Language head helper (sets html[lang] early, no inline JS) -->
  <script defer src="/assets/chattia-head-lang.js"></script>
</head>

<body>
  <div class="app"></div>

  <!-- Floating Action Button -->
  <div class="fab-stack" aria-label="Quick actions">
    <button class="fab fab-accent" id="fabChat" type="button" data-i18n="fab_chat" aria-label="Open chat">Chattia</button>
  </div>

  <!-- Privacy & Consent Modal (chat stays disabled until accepted) -->
  <dialog class="modal" id="consentModal" aria-labelledby="consentTitle">
    <form method="dialog" class="modal-card">
      <div class="modal-head">
        <h2 class="modal-title" id="consentTitle" data-i18n="consent_title">Privacy & Consent</h2>
        <button class="btn btn-ghost" id="consentClose" type="button" aria-label="Close privacy and consent">✕</button>
      </div>

      <p class="modal-text" data-i18n="consent_body">
        Chat interactions may be used to improve the chatbot experience. Please do not enter sensitive personal information.
        OPS Online Support does not intentionally collect payment card data, banking info, passwords, or one-time codes.
      </p>

      <div class="modal-actions">
        <button class="btn btn-secondary" id="consentDeny" value="deny" type="submit" data-i18n="consent_deny">Deny</button>
        <button class="btn btn-primary" id="consentAccept" value="accept" type="submit" data-i18n="consent_accept">Accept</button>
      </div>

      <p class="modal-footnote" data-i18n="consent_note">
        If you deny consent, chat will remain disabled until you accept.
      </p>
    </form>
  </dialog>

  <!-- Chat Panel -->
  <div class="backdrop" id="chatBackdrop" aria-hidden="true"></div>
  <aside class="chat-drawer" id="chatDrawer" aria-label="Chattia" aria-hidden="true">
    <header class="chat-header">
      <div class="chat-title">
        <strong data-i18n="chat_title">Chattia</strong>
      </div>
      <div class="chat-header-actions">
        <div class="chat-header-toggles" aria-label="Chat preferences">
          <button class="btn btn-ghost" id="langToggle" type="button" data-i18n="chat_lang_toggle_text" aria-label="Change language">
            EN
          </button>
          <button class="btn btn-ghost" id="themeToggle" type="button" data-i18n="chat_theme_toggle_text" aria-label="Toggle theme">
            Dark
          </button>
          <button class="btn btn-ghost" id="chatTranscript" type="button" data-i18n="chat_transcript" aria-label="Open copy panel">
            Copy
          </button>
          <button class="btn btn-ghost" id="chatClear" type="button" data-i18n="chat_clear" aria-label="Clear chat">
            Clear
          </button>
        </div>
        <button class="btn btn-ghost" id="chatClose" type="button" aria-label="Close chat">✕</button>
      </div>
    </header>

    <div class="chat-body" id="chatBody" role="log" aria-live="polite" aria-relevant="additions"></div>

    <form class="chat-input" id="chatForm">
      <!-- Honeypot fields (hidden by CSS) -->
      <input class="hp" type="text" name="hp_email" id="hp_email" autocomplete="off" tabindex="-1" aria-hidden="true" hidden />
      <input class="hp" type="text" name="hp_website" id="hp_website" autocomplete="off" tabindex="-1" aria-hidden="true" hidden />

      <!-- Turnstile placeholder (invisible) -->
      <div class="turnstile-slot" id="turnstileSlot" aria-hidden="true"></div>

      <label class="sr-only" for="chatMessage" data-i18n="chat_label">Your message</label>
      <input id="chatMessage" name="message" type="text" maxlength="256" autocomplete="off"
             placeholder="Type your message…" data-i18n-placeholder="chat_placeholder" />

      <button class="btn btn-primary" type="submit" data-i18n="chat_send">Send</button>
    </form>

  </aside>

  <dialog class="modal" id="transcriptModal" aria-hidden="true" aria-labelledby="transcriptTitle">
    <div class="modal-card">
      <div class="modal-head">
        <h2 class="modal-title" id="transcriptTitle" data-i18n="transcript_title">Copy</h2>
        <button class="btn btn-ghost" id="transcriptClose" type="button" aria-label="Close copy panel">✕</button>
      </div>
      <div class="modal-body">
        <p data-i18n="transcript_body">Copy or download your chat history.</p>
        <textarea class="transcript-textarea" id="transcriptText" readonly aria-label="Chat history"></textarea>
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" id="transcriptCopy" type="button" data-i18n="transcript_copy">Copy</button>
        <button class="btn btn-primary" id="transcriptDownload" type="button" data-i18n="transcript_download">Download</button>
      </div>
    </div>
  </dialog>

  <!-- App scripts -->
  <script defer src="/assets/chattia-preferences.js"></script>
  <script defer src="/assets/chattia-ui.js"></script>
</body>
</html>
